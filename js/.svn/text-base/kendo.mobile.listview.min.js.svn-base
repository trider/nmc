/*
* Kendo UI Beta v2012.1.229 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

(function(a,b){function x(b,d){d=a(d);var e=d.parent(),f=d.add(e.children("[data-"+c.ns+"role=detailbutton]"));if(!e.contents().not(f)[0]){var g=e.data(c.ns+"icon"),h=a('<span class="km-icon"/>');d.addClass("km-listview-link").attr(c.attr("role"),"listview-link"),g&&(d.prepend(h),h.addClass("km-"+g))}}function w(b){if(!(b.which>1)){var d=a(b.currentTarget),e=a(b.target).closest("a"),f=d.data(s),g=e.data(c.ns+"role")||"";e[0]&&!g.match(/button/)&&(clearTimeout(f),b.type===o?(f=setTimeout(function(){(!b.originalEvent||!b.originalEvent.defaultPrevented)&&d.toggleClass("km-state-active",!0)},30),d.data(s,f)):d.toggleClass("km-state-active",!1))}}var c=window.kendo,d=c.mobile.ui,e=c.support,f=c.data.DataSource,g=d.Widget,h=".km-list > li",i=a.proxy,j="km-group-title",k='<div class="'+j+'"><span class="km-text"></span></div>',l=c.template('<li><div class="'+j+'">#= this.headerTemplate(data) #</div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),m='<div class="km-listview-wrapper" />',n="function",o=e.mousedown,p=e.mousemove,q=e.mousecancel,r=e.mouseup,s="active-state-timeout",t="km-listview-release",u="km-listview-refresh",v="click",y=g.extend({init:function(b,d){var e=this;g.fn.init.call(e,b,d),d=e.options,e.element.on([o,r,p,q].join(" "),h,w).on(r,h,i(e._click,e)),e.dataSource=f.create(d.dataSource).bind("change",a.proxy(e.refresh,e)),e._templates(),d.dataSource?e.dataSource.fetch():e._style(),e.element.wrap(m),e.wrapper=e.element.parent(),c.notify(e,c.mobile.ui)},events:[v],options:{name:"ListView",type:"flat",template:"${data}",pullToRefresh:!1,appendOnRefresh:!1,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing",headerTemplate:'<span class="km-text">${value}</span>',pullOffset:140,style:""},setOptions:function(a){g.fn.setOptions.call(this,a),this._templates()},viewInit:function(a){var b=this,d=b.options,e=c.template(d.pullTemplate),f=c.template(d.releaseTemplate),g=c.template(d.refreshTemplate);b.scroller=a.scroller,d.pullToRefresh&&(b.wrapper.prepend('<span class="km-listview-pull"><span class="km-icon"></span><span class="km-template">'+e({})+"</span></span>"),b.refreshHint=b.wrapper.children().first(),b.refreshTemplate=b.refreshHint.children(".km-template"),b.scroller.handlePull({offset:d.pullOffset,startPull:function(){b.refreshHint.removeClass(u).addClass(t),b.refreshTemplate.html(f({}))},cancelPull:function(){b.refreshHint.removeClass(t),b.refreshTemplate.html(e({}))},pull:function(){b.refreshHint.removeClass(t).addClass(u),b.refreshTemplate.html(g({})),b.dataSource.read()}}))},refresh:function(){var a=this,b=a.dataSource,d=a.element,e,f=a.options.appendOnRefresh?"prepend":"html",g,h=b.view();a.trigger("dataBinding"),b.group()[0]?(a.options.type="group",g=c.render(a.groupTemplate,h)):g=c.render(a.template,h),a.element[f](g),a.options.pullToRefresh&&(a.scroller.pullHandled(),a.refreshHint.removeClass(u),a.refreshTemplate.html(c.template(a.options.pullTemplate)({}))),c.mobile.init(a.element.children()),a.trigger("dataBound"),a._style()},_templates:function(){var b=this,d=b.options.template,e=b.options.headerTemplate,f=b.dataSource.options.schema.model,g="",h={},i={};f&&(g=' data-uid="#=uid#"'),typeof d===n&&(h.template=d,d="#=this.template(data)#"),i.template=b.template=a.proxy(c.template("<li"+g+">"+d+"</li>"),h),typeof e===n&&(i._headerTemplate=e,e="#=this._headerTemplate(data)#"),i.headerTemplate=c.template(e),b.groupTemplate=a.proxy(l,i)},_click:function(b){if(!(b.which>1)){var d=this,e,f=a(b.currentTarget),g=a(b.target),h=g.closest("["+c.attr("name")+"]",f),i=f.attr(c.attr("uid"));i&&(e=d.dataSource.getByUid(i)),d.trigger(v,{target:g,item:f,dataItem:e,button:h.data("kendoMobileButton")})&&b.preventDefault()}},items:function(){return this.element.find(".km-list").andSelf().find(">li")},_style:function(){var b=this,c=b.options,d=c.type==="group",e=b.element,f=c.style==="inset";e.addClass("km-listview").toggleClass("km-list",!d).toggleClass("km-listinset",!d&&f).toggleClass("km-listgroup",d&&!f).toggleClass("km-listgroupinset",d&&f),d&&(e.children().children("ul").addClass("km-list"),e.find(">li").each(function(){var b=a(this).contents().first();!b.is("ul")&&!b.is("div."+j)&&b.wrap(k)})),b.items().find(">a").each(x),e.closest(".km-content").toggleClass("km-insetcontent",f)}});d.plugin(y)})(jQuery)